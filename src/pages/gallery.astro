---
import Layout from '../layouts/Layout.astro';
import Header from '../components/sections/Header.astro';
import Footer from '../components/sections/Footer.astro';
import SectionContainer from '../components/ui/SectionContainer.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { Masonry } from 'astro-masonry';

// Cargar dinámicamente todas las imágenes de la carpeta awnings
const imageModules = import.meta.glob<{ default: ImageMetadata }>('../assets/images/awnings/*.{webp,png,jpg,jpeg}', {
	eager: true
});

// Convertir a array y filtrar solo imágenes (excluir videos y imágenes específicas que no queremos en la galería)
const excludedImages = ['hero-background.webp', 'hero2-bg.webp', 'right-tsa-awning.webp', 'standout.webp', 'awning.webp', 'pergolof.webp'];

// Primero cargar todas las imágenes con sus índices originales
const allImages = Object.entries(imageModules)
	.map(([path, module], originalIndex) => {
		const image = module.default;
		const filename = path.split('/').pop() || '';
		
		const aspectRatio = image.width && image.height ? image.width / image.height : 1.5;
		return {
			src: image,
			alt: `Roll-up awning installation - ${filename.replace(/\.(webp|png|jpg|jpeg)$/i, '') || 'Gallery image'}`,
			aspectRatio,
			width: image.width,
			height: image.height,
			filename,
			originalIndex, // Mantener el índice original para el viewer
		};
	})
	.filter(img => img.src !== undefined);

// Filtrar solo las imágenes que queremos mostrar en la galería
const galleryImages = allImages.filter(img => 
	!excludedImages.some(excluded => img.filename.includes(excluded))
);
---

<Layout title="Gallery - Tri State Awnings">
	<Header />
	
	<!-- Hero Section -->
	<section class="relative py-20 sm:py-24 md:py-32 lg:py-40 bg-gradient-to-br from-gray-50 to-white">
		<SectionContainer>
			<div class="text-center">
				<h1 class="scroll-fade-in font-sans font-semibold text-4xl sm:text-5xl lg:text-6xl xl:text-7xl mb-6 text-black">
					Project <span class="text-primary italic">Gallery</span>
				</h1>
				<p class="scroll-fade-in font-sans text-lg sm:text-xl lg:text-2xl text-gray-600 max-w-3xl mx-auto" data-delay="1">
					Explore our collection of stunning roll-up awning installations that have transformed outdoor spaces across the Tri-State area.
				</p>
			</div>
		</SectionContainer>
	</section>

	<!-- Gallery Section -->
	<section class="py-12 sm:py-16 md:py-20 lg:py-24 bg-white">
		<SectionContainer>
			<!-- Gallery Grid - Masonry Style -->
			<div class="mb-8 sm:mb-12">
				<Masonry
					breakpointCols={{
						default: 4,
						1280: 4,
						1024: 3,
						640: 2,
						500: 1,
					}}
					class="flex gap-4 sm:gap-6 lg:gap-8"
					columnClass="flex flex-col gap-4 sm:gap-6 lg:gap-8"
					sortByHeight={false}
				>
					{galleryImages.map((image, index) => (
						<div 
							class="gallery-item scroll-fade-in w-full"
							data-index={index}
							style={`animation-delay: ${index * 50}ms;`}
						>
							<a 
								href={`/awning-gallery-viewer?index=${image.originalIndex}`}
								class="gallery-image-wrapper w-full relative group cursor-pointer overflow-hidden rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 block"
								style={`aspect-ratio: ${image.aspectRatio}; min-height: 250px;`}
								transition:name={`gallery-image-${image.originalIndex}`}
							>
								<Image 
									src={image.src}
									alt={image.alt}
									width={image.width}
									height={image.height}
									class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
									loading={index < 4 ? "eager" : "lazy"}
									decoding="async"
									quality={85}
									format="webp"
								/>
								<!-- Overlay on hover -->
								<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/0 to-black/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
								
								<!-- View icon on hover -->
								<div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none">
									<div class="bg-white/90 backdrop-blur-sm rounded-full p-4 transform scale-90 group-hover:scale-100 transition-transform duration-500">
										<svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
										</svg>
									</div>
								</div>
							</a>
						</div>
					))}
				</Masonry>
			</div>
		</SectionContainer>
	</section>

	<Footer />
</Layout>

<script>
	// Script para re-dispatch el evento resize para astro-masonry en page-load
	document.addEventListener('astro:page-load', () => {
		window.dispatchEvent(new Event('resize'));
	});
</script>

<style>
	/* Gallery Item Animation */
	.gallery-item {
		opacity: 0;
		transform: translateY(30px);
		transition:
			opacity 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94),
			transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
		width: 100%;
	}

	.gallery-item.visible {
		opacity: 1;
		transform: translateY(0);
	}

	/* Enhanced hover effects */
	.gallery-image-wrapper {
		position: relative;
		background: #f3f4f6;
	}

	.gallery-image-wrapper::before {
		content: '';
		position: absolute;
		inset: 0;
		border-radius: 1rem;
		padding: 2px;
		background: linear-gradient(135deg, rgba(104, 194, 140, 0.3), rgba(104, 194, 140, 0.1));
		-webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
		-webkit-mask-composite: xor;
		mask-composite: exclude;
		opacity: 0;
		transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
		pointer-events: none;
		z-index: 1;
	}

	.gallery-image-wrapper:hover::before {
		opacity: 1;
	}

	/* Smooth image loading */
	.gallery-image-wrapper img {
		will-change: transform;
	}

	/* Responsive adjustments */
	@media (max-width: 640px) {
		.gallery-image-wrapper {
			border-radius: 1rem;
		}
	}
</style>

