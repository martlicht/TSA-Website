---
import { Image } from 'astro:assets';
import SectionContainer from '../../ui/SectionContainer.astro';
import hero2Background from '../../../assets/images/awnings/hero2-bg.webp';
---

<section class="relative w-full min-h-screen flex items-center justify-center overflow-hidden py-16 sm:py-20">
	<!-- Background Image -->
	<div class="absolute inset-0">
		<Image 
			src={hero2Background}
			alt="Contact Background"
			class="w-full h-full object-cover"
			loading="eager"
			quality={80}
			format="webp"
		/>
	</div>

	<!-- Dark Overlay for better contrast -->
	<div class="absolute inset-0 bg-gradient-to-br from-black/70 via-black/60 to-black/70"></div>

	<!-- Content -->
	<SectionContainer class="relative z-10">
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
			<!-- Left: Headline -->
			<div class="text-white">
				<h2 class="contact-headline mb-6">
					Find out how<br />
					we can<br />
					transform<br />
					<span class="text-primary italic">your</span> space.
				</h2>
			</div>

			<!-- Right: Form Card -->
			<div class="contact-form-card bg-white/95 backdrop-blur-sm rounded-3xl p-8 sm:p-10 shadow-2xl">
				<form id="contact-form" class="space-y-6">
					<!-- First Name & Last Name -->
					<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
						<div>
							<label for="firstName" class="form-label">
								First name
							</label>
							<input
								type="text"
								id="firstName"
								name="firstName"
								placeholder="First name"
								required
								class="form-input"
							/>
						</div>
						<div>
							<label for="lastName" class="form-label">
								Last name
							</label>
							<input
								type="text"
								id="lastName"
								name="lastName"
								placeholder="Last name"
								required
								class="form-input"
							/>
						</div>
					</div>

					<!-- Email -->
					<div>
						<label for="email" class="form-label">
							Email
						</label>
						<input
							type="email"
							id="email"
							name="email"
							placeholder="you@company.com"
							required
							class="form-input"
						/>
					</div>

					<!-- Phone Number -->
					<div>
						<label for="phone" class="form-label">
							Phone number
						</label>
						<div class="phone-input-wrapper">
							<div class="country-code-selector">
								<select
									id="countryCode"
									name="countryCode"
									class="country-code-select"
									aria-label="Country code"
								>
									<option value="+1" data-flag="ðŸ‡ºðŸ‡¸">US</option>
									<option value="+44" data-flag="ðŸ‡¬ðŸ‡§">UK</option>
									<option value="+52" data-flag="ðŸ‡²ðŸ‡½">MX</option>
									<option value="+33" data-flag="ðŸ‡«ðŸ‡·">FR</option>
									<option value="+49" data-flag="ðŸ‡©ðŸ‡ª">DE</option>
									<option value="+39" data-flag="ðŸ‡®ðŸ‡¹">IT</option>
									<option value="+34" data-flag="ðŸ‡ªðŸ‡¸">ES</option>
									<option value="+61" data-flag="ðŸ‡¦ðŸ‡º">AU</option>
									<option value="+1" data-flag="ðŸ‡¨ðŸ‡¦">CA</option>
								</select>
							</div>
							<input
								type="tel"
								id="phone"
								name="phone"
								placeholder="(555) 000-0000"
								required
								class="form-input phone-input"
								maxlength="17"
							/>
						</div>
					</div>

					<!-- Privacy Policy Checkbox -->
					<!-- <div class="flex items-start gap-3">
						<input
							type="checkbox"
							id="privacyPolicy"
							name="privacyPolicy"
							required
							class="mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2"
						/>
						<label for="privacyPolicy" class="text-sm text-gray-600">
							You agree to our friendly <a href="/privacy-policy" class="text-primary underline hover:text-primary-dark">privacy policy</a>.
						</label>
					</div> -->

					<!-- Submit Button -->
					<button
						type="submit"
						class="w-full bg-primary text-white font-medium text-lg py-4 rounded-lg hover:bg-primary-dark transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
					>
						Send message
					</button>

					<!-- Success Message (hidden by default) -->
					<div id="success-message" class="hidden p-4 bg-green-50 border border-green-200 rounded-lg">
						<p class="text-green-800 text-center font-medium">
							âœ“ Message sent successfully! We'll get back to you soon.
						</p>
					</div>

					<!-- Error Message (hidden by default) -->
					<div id="error-message" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
						<p class="text-red-800 text-center font-medium">
							âœ— Something went wrong. Please try again.
						</p>
					</div>
				</form>
			</div>
		</div>
	</SectionContainer>
</section>

<style>
	/* Contact Headline */
	.contact-headline {
		font-family: 'Inter', system-ui, sans-serif;
		font-weight: 700;
		font-size: 3rem;
		line-height: 110%;
		letter-spacing: -0.02em;
	}

	@media (min-width: 640px) {
		.contact-headline {
			font-size: 3.5rem;
		}
	}

	@media (min-width: 1024px) {
		.contact-headline {
			font-size: 4rem;
		}
	}

	/* Form Card */
	.contact-form-card {
		max-width: 500px;
		margin: 0 auto;
		width: 100%;
	}

	@media (min-width: 1024px) {
		.contact-form-card {
			margin: 0;
		}
	}

	/* Form Label */
	.form-label {
		display: block;
		font-family: 'Inter', system-ui, sans-serif;
		font-weight: 500;
		font-size: 0.875rem;
		color: #6B7280;
		margin-bottom: 0.5rem;
	}

	/* Form Input */
	.form-input {
		width: 100%;
		padding: 0.875rem 1rem;
		font-size: 1rem;
		color: #111827;
		background-color: #F9FAFB;
		border: 1px solid #E5E7EB;
		border-radius: 0.5rem;
		transition: all 0.2s;
		font-family: 'Inter', system-ui, sans-serif;
	}

	.form-input:focus {
		outline: none;
		border-color: #68C28C;
		background-color: #FFFFFF;
		box-shadow: 0 0 0 3px rgba(104, 194, 140, 0.1);
	}

	.form-input::placeholder {
		color: #9CA3AF;
	}

	/* Phone Input Wrapper */
	.phone-input-wrapper {
		position: relative;
		display: flex;
		align-items: center;
		background-color: #F9FAFB;
		border: 1px solid #E5E7EB;
		border-radius: 0.5rem;
		transition: all 0.2s;
	}

	.phone-input-wrapper:focus-within {
		border-color: #68C28C;
		background-color: #FFFFFF;
		box-shadow: 0 0 0 3px rgba(104, 194, 140, 0.1);
	}

	/* Country Code Selector */
	.country-code-selector {
		position: relative;
		flex-shrink: 0;
	}

	.country-code-select {
		padding: 0.875rem 2.5rem 0.875rem 1rem;
		font-size: 1rem;
		color: #111827;
		background-color: transparent;
		border: none;
		border-right: 1px solid #E5E7EB;
		border-radius: 0.5rem 0 0 0.5rem;
		font-family: 'Inter', system-ui, sans-serif;
		font-weight: 500;
		cursor: pointer;
		appearance: none;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
		background-repeat: no-repeat;
		background-position: right 0.75rem center;
		transition: all 0.2s;
	}

	.country-code-select:hover {
		background-color: rgba(0, 0, 0, 0.02);
	}

	.country-code-select:focus {
		outline: none;
	}

	.phone-input-wrapper:focus-within .country-code-select {
		border-right-color: #68C28C;
	}

	/* Phone Input */
	.phone-input {
		flex: 1;
		border: none;
		border-radius: 0 0.5rem 0.5rem 0;
		background-color: transparent;
		padding-left: 0.75rem;
	}

	.phone-input:focus {
		outline: none;
		box-shadow: none;
		background-color: transparent;
	}

	.phone-input-wrapper:focus-within .phone-input {
		background-color: transparent;
	}
</style>

<script>
	// Phone Number Formatting
	function formatPhoneNumber(value: string, countryCode: string): string {
		// Remove all non-digit characters
		const digits = value.replace(/\D/g, '');
		
		// Format based on country code
		if (countryCode === '+1') {
			// US/Canada format: (555) 000-0000
			if (digits.length <= 3) {
				return digits;
			} else if (digits.length <= 6) {
				return `(${digits.slice(0, 3)}) ${digits.slice(3)}`;
			} else {
				return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;
			}
		} else if (countryCode === '+44') {
			// UK format: 020 0000 0000
			if (digits.length <= 3) {
				return digits;
			} else if (digits.length <= 7) {
				return `${digits.slice(0, 3)} ${digits.slice(3)}`;
			} else {
				return `${digits.slice(0, 3)} ${digits.slice(3, 7)} ${digits.slice(7, 11)}`;
			}
		} else {
			// Default: just add spaces every 3-4 digits
			return digits.replace(/(\d{3})(\d{3})(\d+)/, '$1 $2 $3').trim();
		}
	}

	function updatePhonePlaceholder(countryCode: string) {
		const phoneInput = document.getElementById('phone') as HTMLInputElement;
		if (!phoneInput) return;

		const placeholders: Record<string, string> = {
			'+1': '(555) 000-0000',
			'+44': '020 0000 0000',
			'+52': '55 0000 0000',
			'+33': '01 23 45 67 89',
			'+49': '030 00000000',
			'+39': '02 0000 0000',
			'+34': '912 34 56 78',
			'+61': '02 0000 0000',
		};

		phoneInput.placeholder = placeholders[countryCode] || '(555) 000-0000';
	}

	function initPhoneInput() {
		const phoneInput = document.getElementById('phone') as HTMLInputElement;
		const countryCodeSelect = document.getElementById('countryCode') as HTMLSelectElement;

		if (!phoneInput || !countryCodeSelect) return;

		// Update placeholder on country code change
		countryCodeSelect.addEventListener('change', () => {
			updatePhonePlaceholder(countryCodeSelect.value);
			// Clear and reformat phone input when country changes
			const digits = phoneInput.value.replace(/\D/g, '');
			phoneInput.value = formatPhoneNumber(digits, countryCodeSelect.value);
		});

		// Format phone number as user types
		phoneInput.addEventListener('input', (e) => {
			const target = e.target as HTMLInputElement;
			const countryCode = countryCodeSelect.value;
			const formatted = formatPhoneNumber(target.value, countryCode);
			target.value = formatted;
		});

		// Prevent non-digit characters (except formatting)
		phoneInput.addEventListener('keypress', (e) => {
			const char = String.fromCharCode(e.which || e.keyCode);
			if (!/[0-9]/.test(char) && e.which !== 8 && e.which !== 0) {
				e.preventDefault();
			}
		});

		// Initialize placeholder
		updatePhonePlaceholder(countryCodeSelect.value);
	}

	// Contact Form Handler
	function initContactForm() {
		const form = document.getElementById('contact-form') as HTMLFormElement;
		const successMessage = document.getElementById('success-message');
		const errorMessage = document.getElementById('error-message');

		if (!form) return;

		// Initialize phone input
		initPhoneInput();

		form.addEventListener('submit', async (e) => {
			e.preventDefault();

			// Hide previous messages
			successMessage?.classList.add('hidden');
			errorMessage?.classList.add('hidden');

			// Validate phone number
			const phoneInput = document.getElementById('phone') as HTMLInputElement;
			const countryCode = (document.getElementById('countryCode') as HTMLSelectElement)?.value || '+1';
			const phoneDigits = phoneInput?.value.replace(/\D/g, '') || '';
			
			// Minimum phone number length validation (at least 10 digits for most countries)
			if (phoneDigits.length < 10) {
				phoneInput?.setCustomValidity('Please enter a valid phone number');
				phoneInput?.reportValidity();
				return;
			} else {
				phoneInput?.setCustomValidity('');
			}

			// Get form data
			const formData = new FormData(form);
			const fullPhoneNumber = `${countryCode} ${phoneInput?.value || ''}`;
			
			const data = {
				firstName: formData.get('firstName'),
				lastName: formData.get('lastName'),
				email: formData.get('email'),
				countryCode: countryCode,
				phone: phoneInput?.value || '',
				fullPhoneNumber: fullPhoneNumber,
				privacyPolicy: formData.get('privacyPolicy') === 'on',
				timestamp: new Date().toISOString(),
			};

			console.log('Form Data:', data);

			try {
				// TODO: Replace with actual API endpoint
				// const response = await fetch('/api/contact', {
				// 	method: 'POST',
				// 	headers: {
				// 		'Content-Type': 'application/json',
				// 	},
				// 	body: JSON.stringify(data),
				// });

				// if (!response.ok) {
				// 	throw new Error('Failed to send message');
				// }

				// Simulate successful submission
				await new Promise(resolve => setTimeout(resolve, 1000));

				// Show success message
				successMessage?.classList.remove('hidden');
				
				// Reset form
				form.reset();

				// Hide success message after 5 seconds
				setTimeout(() => {
					successMessage?.classList.add('hidden');
				}, 5000);

			} catch (error) {
				console.error('Error submitting form:', error);
				
				// Show error message
				errorMessage?.classList.remove('hidden');

				// Hide error message after 5 seconds
				setTimeout(() => {
					errorMessage?.classList.add('hidden');
				}, 5000);
			}
		});
	}

	// Initialize on page load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initContactForm);
	} else {
		initContactForm();
	}

	// Re-initialize after Astro page transitions
	document.addEventListener('astro:page-load', initContactForm);
</script>

