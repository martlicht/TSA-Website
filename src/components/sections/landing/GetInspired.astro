---
import { Image } from 'astro:assets';
import SectionContainer from '../../ui/SectionContainer.astro';
import carousel1 from '../../../assets/images/caurusel1.png';
import carousel2 from '../../../assets/images/caurusel2.png';
import carousel3 from '../../../assets/images/caurusel3.png';
import pool from '../../../assets/images/pool.png';
import staircase from '../../../assets/images/staircase.png';
import door from '../../../assets/images/door.png';
import plexiAwning from '../../../assets/images/plexi_awning.png';
import rollUpAwning from '../../../assets/images/roll_up_awning.png';
import vestibule from '../../../assets/images/vestibule.png';

const carouselImages = [
	{ src: carousel1, alt: 'Retractable awning installation showcasing outdoor living space' },
	{ src: carousel2, alt: 'Modern patio awning providing shade and protection' },
	{ src: carousel3, alt: 'Custom awning design enhancing residential exterior' },
	{ src: pool, alt: 'Pool area with retractable awning for sun protection' },
	{ src: staircase, alt: 'Staircase area with elegant awning installation' },
	{ src: door, alt: 'Entryway with decorative awning providing shelter' },
	{ src: plexiAwning, alt: 'Plexiglass awning offering weather protection' },
	{ src: rollUpAwning, alt: 'Roll-up retractable awning system' },
	{ src: vestibule, alt: 'Vestibule entrance with custom awning design' }
];
---

<section class="py-12 sm:py-16 md:py-20 lg:py-24 bg-white overflow-x-hidden">
	<SectionContainer>
		<!-- Text Content -->
		<div class="mb-12 sm:mb-16">
			<h2 class="inspired-headline scroll-fade-in text-4xl sm:text-5xl lg:text-6xl font-semibold mb-4">
				Get <span class="text-primary italic">Inspired</span>
			</h2>
			<p class="inspired-subtext scroll-fade-in text-lg sm:text-xl text-gray-600 mb-6" style="animation-delay: 100ms;">
				See what's possible in our gallery
			</p>
			<a href="/gallery" class="scroll-fade-in inline-flex items-center gap-2 text-primary font-medium text-lg hover:gap-3 transition-all" style="animation-delay: 200ms;">
				Learn more
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
				</svg>
			</a>
		</div>

		<!-- Carousel Container -->
		<div class="swiper-carousel overflow-hidden">
			<div class="swiper-wrapper">
				{carouselImages.map((item, index) => (
					<div class="swiper-slide">
						<div class="carousel-card rounded-2xl overflow-hidden aspect-[4/3] sm:aspect-video">
							<Image 
								src={item.src}
								alt={item.alt}
								class="w-full h-full object-cover"
								loading="lazy"
								quality={85}
								format="webp"
								width={400}
								height={300}
							/>
						</div>
					</div>
				))}
			</div>
		</div>
	</SectionContainer>
</section>

<style>
	/* Inspired Headline */
	.inspired-headline {
		font-family: 'Inter', system-ui, sans-serif;
		font-weight: 600;
		line-height: 1.2;
		letter-spacing: -0.02em;
		color: #000000;
	}

	/* Subtext */
	.inspired-subtext {
		font-family: 'Inter', system-ui, sans-serif;
		font-weight: 400;
		line-height: 1.5;
		letter-spacing: -0.002em;
	}

	/* Swiper Container - Same margins as SectionContainer */
	.swiper-carousel {
		width: 100%;
		overflow: hidden;
		position: relative;
	}

	.swiper-wrapper {
		display: flex;
		transition-timing-function: linear;
		width: fit-content;
	}

	.swiper-slide {
		flex-shrink: 0;
		width: 400px !important;
		height: auto;
	}

	/* Carousel Card - Figma specs */
	.carousel-card {
		width: 100%;
		height: 100%;
		border: 1px solid rgba(0, 0, 0, 0.1); /* Stroke: #000000 10% */
		box-shadow: 
			0 1px 2px rgba(0, 0, 0, 0.05),
			0 2px 4px rgba(0, 0, 0, 0.05); /* Drop shadows */
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	.carousel-card:hover {
		transform: translateY(-2px);
		box-shadow: 
			0 4px 6px rgba(0, 0, 0, 0.07),
			0 8px 12px rgba(0, 0, 0, 0.07);
	}

	.carousel-card img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	@media (max-width: 640px) {
		.swiper-slide {
			width: 300px !important;
		}
	}

	/* Performance: Reduce repaints during scroll */
	.swiper-wrapper {
		will-change: transform;
	}

	/* Optimize image rendering */
	.carousel-card img {
		content-visibility: auto;
	}

	/* Prevent horizontal scrollbar */
	section {
		overflow-x: hidden;
		max-width: 100vw;
		position: relative;
		width: 100%;
		box-sizing: border-box;
	}

	/* Ensure carousel doesn't cause overflow */
	.swiper-carousel {
		box-sizing: border-box;
	}

	/* Prevent wrapper from extending beyond viewport */
	.swiper-wrapper {
		box-sizing: border-box;
	}
</style>

<!-- Swiper CSS - Preload for performance -->
<link rel="preload" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" /></noscript>

<script>
	import Swiper from 'swiper';
	import { Autoplay, FreeMode } from 'swiper/modules';
	
	// @ts-ignore - Swiper instance type
	let swiperInstance = null;
	
	function initCarousel() {
		const swiperEl = document.querySelector('.swiper-carousel');
		if (!swiperEl) {
			return;
		}

		// Clean up existing instance if it exists
		// @ts-ignore
		if (swiperInstance) {
			// @ts-ignore
			swiperInstance.destroy(true, true);
			swiperInstance = null;
		}

		try {
			swiperInstance = new Swiper('.swiper-carousel', {
				modules: [Autoplay, FreeMode],
				slidesPerView: 'auto',
				spaceBetween: 24,
				loop: true,
				speed: 3000,
				autoplay: {
					delay: 0,
					disableOnInteraction: false,
				},
				freeMode: true,
				allowTouchMove: true,
				grabCursor: true,
				// Performance optimizations
				watchSlidesProgress: true,
				breakpoints: {
					320: {
						spaceBetween: 16,
					},
					640: {
						spaceBetween: 24,
					}
				}
			});
		} catch (error) {
			// Silent error handling - only log in development
			if (import.meta.env.DEV) {
				console.error('Error initializing Swiper:', error);
			}
		}
	}
	
	// Initialize when DOM is ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initCarousel);
	} else {
		initCarousel();
	}

	// Re-initialize on Astro page transitions
	document.addEventListener('astro:page-load', initCarousel);
	
	// Cleanup on page unload
	document.addEventListener('astro:before-preparation', () => {
		// @ts-ignore
		if (swiperInstance) {
			// @ts-ignore
			swiperInstance.destroy(true, true);
			swiperInstance = null;
		}
	});
</script>

