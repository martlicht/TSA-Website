---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import SectionContainer from '../../ui/SectionContainer.astro';

// Import all Pergoloft images dynamically
const imageModules = import.meta.glob<{ default: ImageMetadata }>('../../../assets/images/pergoloft/*.{webp,png,jpg,jpeg}', {
	eager: true
});

// Filter out hero image and convert to array
const galleryImages = Object.entries(imageModules)
	.filter(([path]) => !path.includes('hero'))
	.map(([path, module]) => {
		const image = module.default;
		const aspectRatio = image.width && image.height ? image.width / image.height : 1.5;
		return {
			src: image,
			alt: `Pergoloft glass pergola installation - ${path.split('/').pop()?.replace(/\.(webp|png|jpg|jpeg)$/i, '') || 'Gallery image'}`,
			aspectRatio,
			width: image.width,
			height: image.height,
		};
	});
---

<section id="gallery-section" class="py-16 sm:py-20 md:py-24 lg:py-32 bg-gray-50">
	<SectionContainer>
		<!-- Header -->
		<div class="text-center mb-12 sm:mb-16">
			<span class="inline-block text-primary font-semibold text-sm uppercase tracking-wider mb-4">Our Portfolio</span>
			<h2 class="scroll-fade-in font-sans text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 text-gray-900">
				See It In <span class="text-primary italic">Action</span>
			</h2>
			<p class="scroll-fade-in text-gray-600 text-lg max-w-2xl mx-auto" style="animation-delay: 100ms;">
				Browse our collection of stunning Pergoloft installations across the Tri-State area.
			</p>
		</div>

		<!-- Gallery Grid -->
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
			{galleryImages.map((image, index) => (
				<div 
					class={`scroll-fade-in group relative overflow-hidden rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 ${index === 0 ? 'sm:col-span-2 sm:row-span-2' : ''}`}
					style={`animation-delay: ${index * 80}ms;`}
				>
					<div class={`relative ${index === 0 ? 'aspect-[4/3] sm:aspect-square' : 'aspect-[4/3]'}`}>
						<Image 
							src={image.src}
							alt={image.alt}
							class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
							loading="lazy"
							quality={85}
							format="webp"
						/>
						<!-- Hover Overlay -->
						<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
							<div class="absolute bottom-4 left-4 right-4">
								<p class="text-white font-medium text-sm sm:text-base">View Installation</p>
							</div>
						</div>
						<!-- Corner Accent -->
						<div class="absolute top-4 right-4 w-3 h-3 border-t-2 border-r-2 border-white/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
						<div class="absolute bottom-4 left-4 w-3 h-3 border-b-2 border-l-2 border-white/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
					</div>
				</div>
			))}
		</div>
	</SectionContainer>
</section>
